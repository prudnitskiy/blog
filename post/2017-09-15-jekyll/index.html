<!doctype html><html lang=ru-ru data-theme>
<head>
<meta charset=utf-8>
<meta name=HandheldFriendly content="True">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=referrer content="no-referrer-when-downgrade">
<title>Как (и зачем) перевести блог на статический сайт - SRE Blog</title>
<meta name=description content="Согласно статстике W3Tech 98.5% современных сайтов – это динамические сайты. Строго говоря – это программы (порой – большие и сложные программы), мощные многоэтажные системы, связаные со сложными системами хранения данных. Каждое посещение такого сайта – это выполнение кода, что требует ресурсов сервера и времени. При этом реально в большинстве случаев вся эта мощь не используется – большинство сайтов довольно компактные и редко обновляются. А значит – мощная, сложная, гибкая, многокомпонентная, что самое страшное – потенциально ненадежная система, в общем-то, не нужна.
Перевод сайта с динамики на статику – это простой и удобный способ обойтись без сложностей, не потеряв гибкости и удобства.">
<link rel=icon type=image/x-icon href=https://prudnitskiy.pro/favicon.ico>
<link rel=apple-touch-icon-precomposed href=https://prudnitskiy.pro/favicon.png>
<link rel=stylesheet href=https://prudnitskiy.pro/css/style.min.63aba568b2393a8f5a364a508001b05c9412a603d1a0a69bd50f9944649f9c56.css integrity="sha256-Y6ulaLI5Oo9aNkpQgAGwXJQSpgPRoKab1Q+ZRGSfnFY=">
<script src=https://prudnitskiy.pro/js/script.min.510c781c39dbb21b4c76d85c82e2bdf4689220adbb7cd61e49e9d293e442fb42.js type=text/javascript integrity="sha256-UQx4HDnbshtMdthcguK99GiSIK27fNYeSenSk+RC+0I="></script>
<meta property="og:title" content="Как (и зачем) перевести блог на статический сайт">
<meta property="og:description" content="Согласно статстике W3Tech 98.5% современных сайтов – это динамические сайты. Строго говоря – это программы (порой – большие и сложные программы), мощные многоэтажные системы, связаные со сложными системами хранения данных. Каждое посещение такого сайта – это выполнение кода, что требует ресурсов сервера и времени. При этом реально в большинстве случаев вся эта мощь не используется – большинство сайтов довольно компактные и редко обновляются. А значит – мощная, сложная, гибкая, многокомпонентная, что самое страшное – потенциально ненадежная система, в общем-то, не нужна.
Перевод сайта с динамики на статику – это простой и удобный способ обойтись без сложностей, не потеряв гибкости и удобства.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://prudnitskiy.pro/post/2017-09-15-jekyll/"><meta property="article:section" content="post">
<meta property="article:published_time" content="2017-09-15T21:40:00+00:00">
<meta property="article:modified_time" content="2017-09-15T21:40:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Как (и зачем) перевести блог на статический сайт">
<meta name=twitter:description content="Согласно статстике W3Tech 98.5% современных сайтов – это динамические сайты. Строго говоря – это программы (порой – большие и сложные программы), мощные многоэтажные системы, связаные со сложными системами хранения данных. Каждое посещение такого сайта – это выполнение кода, что требует ресурсов сервера и времени. При этом реально в большинстве случаев вся эта мощь не используется – большинство сайтов довольно компактные и редко обновляются. А значит – мощная, сложная, гибкая, многокомпонентная, что самое страшное – потенциально ненадежная система, в общем-то, не нужна.
Перевод сайта с динамики на статику – это простой и удобный способ обойтись без сложностей, не потеряв гибкости и удобства.">
</head>
<body>
<a class=skip-main href=#main>Skip to main content</a>
<div class=container>
<header class=common-header>
<div class=header-top>
<h1 class=site-title>
<a href=/>SRE Blog</a>
</h1>
<ul class=social-icons>
<li>
<a href=https://github.com/prudnitskiy title=Github rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentcolor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6.0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6.0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3.0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1.0-6.2-.3-40.4-.3-61.4.0.0-70 15-84.7-29.8.0.0-11.4-29.1-27.8-36.6.0.0-22.9-15.7 1.6-15.4.0.0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5.0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9.0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4.0 33.7-.3 75.4-.3 83.6.0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6.0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9.0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
</span>
</a>
</li>
<li>
<a href=https://www.linkedin.com/in/prudnitskiy title=Linkedin rel=me>
<span class=inline-svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentcolor" d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg>
</span>
</a>
</li>
</ul>
</div>
<nav>
<a href=https://prudnitskiy.pro/about/ title=About>About</a>
<a href=https://prudnitskiy.pro/ title=Blog>Blog</a>
</nav>
</header>
<main id=main tabindex=-1>
<article class="post h-entry">
<div class=post-header>
<header>
<h1 class="p-name post-title">Как (и зачем) перевести блог на статический сайт</h1>
</header>
</div>
<div class="content e-content">
<p>Согласно <a href=https://w3techs.com/technologies/overview/programming_language/all>статстике W3Tech</a> 98.5% современных сайтов – это динамические сайты. Строго говоря – это программы (порой – большие и сложные программы), мощные многоэтажные системы, связаные со сложными системами хранения данных. Каждое посещение такого сайта – это выполнение кода, что требует ресурсов сервера и времени. При этом реально в большинстве случаев вся эта мощь не используется – большинство сайтов довольно компактные и редко обновляются. А значит – мощная, сложная, гибкая, многокомпонентная, что самое страшное – потенциально ненадежная система, в общем-то, не нужна.</p>
<p>Перевод сайта с динамики на статику – это простой и удобный способ обойтись без сложностей, не потеряв гибкости и удобства.</p>
<h2 id=необязательная-предыстория>Необязательная предыстория
<span>
<a href=#%d0%bd%d0%b5%d0%be%d0%b1%d1%8f%d0%b7%d0%b0%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d0%b0%d1%8f-%d0%bf%d1%80%d0%b5%d0%b4%d1%8b%d1%81%d1%82%d0%be%d1%80%d0%b8%d1%8f><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Когда интернет только появился – все сайты были сверстаны статически. Каждый сайт был простым набором физических файлов. Эти файлы лежали на физическом диске. При обращении к URL веб-сервер транслировал относительный путь в путь в файловой системе, физически читал файл с диска и отдавал его клиенту. Такой подход очень просто программируется, написать простейший web-server на любом современном языке можно за пару часов. При статической верстке очень легко управлять кешированием - достаточно читать атрибуты файла и отправлять их в заголовок. Проблемы начались с ростом объема сайта. Если вы создаете страницы по очереди - вы можете писать их руками, по одной. Проблемы начинаются, когда нужно поменять что-то во всех страницах разом. Десять страниц можно поменять руками. 20 - сложно. 100 - очень сложно. На пятой тысяче вы сильно пожалеете, что вообще вписались в эту задачу. Так же все эти файлы физически лежат на диске и занимают прорву места. Причем большая часть этих файлов - совершенно одинаковая (верстка и художественное оформление у страниц общее, отличаются они только содержанием).</p>
<p>Для того, чтобы решить эту проблему - была придумана динамическая верстка и базы данных.</p>
<p>Работало (и работает до сих пор) концептуально это очень просто:</p>
<ul>
<li>Запрос из сети вызывает выполнение кода на сервере (это и есть наш сайт, точнее - его часть).</li>
<li>При выполнении код выясняет, какие данные требуются пользователю.</li>
<li>Часть данных может быть прямо в коде (название сайта, имя автора, год публикации), а часть – лежит во внешнем хранилище, например - в базе данных.</li>
<li>Код лезет в базу данных и вытаскивает оттуда нужные данные.</li>
<li>Код загружает шаблон, на основе которого он будет рисовать страницу. Шаблон - это та же страница с версткой, дизайном и всеми атрибутами.В ней нет только реальных данных, вместо них там стоят метки вида <code>{заголовок будет тут}</code>.</li>
<li>Код вставляет в шаблон все необходимые данные и рисует страницу. Обычно готовая страница лежит в оперативной памяти сервера и ждет отдачи.</li>
<li>Сервер получает от кода сообщение о готовности и отрисованую страницу.</li>
<li>Сервер отдает страницу пользователю.</li>
</ul>
<p>Современный сервер выполняет весь этот набор действий довольно быстро, но за конечное время. Обычно полный цикл занимает 100-200 миллисекунд + еще 50-100 миллисекунд требуется на доступ к базе. Проблемы начинаются на больших нагрузках. Либо резко кончаются ресурсы (каждый запрос обрабатывается независимым куском кода и в базу тоже ходит независимо). Либо сервер ставит запросы на обработку в очередь и сайт начинает тормозить (или вообще отваливается, если пользователь просто не успел дождаться своей очереди).</p>
<p>Динамические сайты – это фантастически удобно. Когда данные лежат во внешнем хранилище – можно организовать туда доступ из нескольких мест. Например, сделать зоомагазины для кошек и для собак, но товары держать в общей базе. Это позволит показывать на каждом сайте уникальные для именно этого сайта товары + общие товары для обеих групп покупателей. Базы позволяют делать &ldquo;срезы&rdquo; данных по любому направлению. Это позволяет показать пользователю любой набор информации из базы, ограничив его любыми критериями. Данные всегда забираются из базы, а значит, обновив данные в базе мы моментально обновим их на сайте, никаких задержек. Динамические сайты используют для отображения шаблоны, а значит – не нужно муторно перерисовывать каждую страницу, если в ней нашлась какая-то проблема. Одна правка в одном месте сразу поправит все.</p>
<p>По этой причине динамические сайты стали основой современного интернета. Статические сайты никто не делает, потому, что это неудобно и трудозатраты кажутся неадекватными. Однако, если собрать статистику по сайтам в интернете, выясняется, что:</p>
<ul>
<li>Подавляющее большинство сайтов имеет очень маленький размер – единицы, в редком случае десятки, в очень редком - сотни страниц. К примеру, возьмем блог. Это будет хороший блог очень обязательного человека, который пишет пост раз в неделю. В году всего 52 недели, то есть за каждый год существования блог вырастет на 52 страницы. За 10 лет - 520 страниц. Много ли вы видели десятилетних блогов?</li>
<li>Подавляющее большинство сайтов очень редко обновляется, и им просто не нужна высокая легкость и скорость обновления.</li>
<li>Подавляющее большинство сайтов очень редко посещается. Тут нужно сделать небольшое отступление и рассказать про кеш.</li>
</ul>
<p>Идея кеширования в том, что если пользователи часто запрашивают некие данные - их проще не готовить по всей цепочке, а сохранить в уже подготовленном виде и отдавать сразу. Вместо 300 мсек на запрос получаем 10 мсек + освобождаем ресурсы сервера (так, как данные не надо готовить и отрисовывать, можно отдать уже готовую отрисованную страницу). Основная проблема кеша – его срок жизни. В момент, когда он создается, указывается, сколько времени должен жить объект. Когда объект закончит свое существование и будет удален - первый пользователь, который пойдет в обход кеша - вызовет запуск кода (и создание нового объекта). Отсюда вытекает две проблемы:</p>
<ul>
<li>Если сайт обновился - пользователи об этом не узнают, пока не умрет кешированный объект. Единственный способ избежать этого - при обновлении сайта найти и удалить объекты, которые ссылаются на необновленные данные.</li>
<li>Если пользователи приходят редко - кеширование не имеет никакого смысла, потому, что объект кеша умрет раньше, чем его кто-то увидит.</li>
</ul>
<p>При этом кеш сам по себе съедает ресурсы – для хранения кешированных объектов выделяется память, плюс кто-то должен выяснять, что отдавать пользователю – кешированный объект или идти к серверу за новым (и кешировать его).</p>
<p>Еще одна серьезная проблема динамических сайтов – это безопасность. Динамический сайт – это код. В коде бывают ошибки. Более того – в коде <em>вероятны</em> ошибки. Потенциально ошибка грозит утечкой данных сайта (в лучшем случае) или вовсе – захватом сервера, где сайт живет. Если у вас есть динамический сайт – вам нужен кто-то, кто будет следить за его состоянием. Обновлять код. Отслеживать попытки взлома и реагировать на них.</p>
<p>Собственно, для решения этих проблем были придуманы генераторы статических сайтов. Это была попытка взять &ldquo;лучшее из двух миров&rdquo; – просту и легкость работы статического сайта и удобство работы с динамическими данными.</p>
<h2 id=что-такое-jekyll>Что такое Jekyll
<span>
<a href=#%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-jekyll><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Jekyll – один из многих генераторов статических сайтов. Генераторы пытаются совмещать несовемстимое – удобство обслуживания сайта динамического и легкость сайта, сверстанного статически. Работает это следующим образом:</p>
<ul>
<li>Данные для сайта сохраняются в виде текстовых файлов в специальном формате (он простой).</li>
<li>Внешний вид и верстка сайта оформляется шаблонами (используется движок <a href=https://shopify.github.io/liquid/>liquid</a> от shopify).</li>
<li>Команда <code>jekyll build</code> проверяет все данные и отрисовывает сайт по шаблону в виде набора статичных файлов. Готовые файлы сохраняются на диск.</li>
<li>Готовые статичные файлы можно положить на сервер и сделать доступными в сети.</li>
</ul>
<h3 id=когда-вам-нужен-jekyll-pros>Когда вам нужен jekyll (pros)
<span>
<a href=#%d0%ba%d0%be%d0%b3%d0%b4%d0%b0-%d0%b2%d0%b0%d0%bc-%d0%bd%d1%83%d0%b6%d0%b5%d0%bd-jekyll-pros><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><ul>
<li>Если у вас небольшой сайт (PR-страница, личный или корпоративный блог).</li>
<li>Если ваш сайт обновляется сравнительно редко и делает это один человек (или несколько, но вы можете договорится о процедуре обновления).</li>
<li>Если вам нужно очень сильно сэкономить (хостинг статических файлов можно найти бесплатно).</li>
<li>Если сайт некрупный, но планируется <strong>очень</strong> большая нагрузка (статический сайт будет обрабатываться быстрее динамического).</li>
<li>Если вам очень важна безопасность, но нет средств на программиста, который будет поддерживать код вашего сайта (jekyll создает статические страницы, а на сервере никакой код не выполняется в принципе – ломать там нечего).</li>
</ul>
<h3 id=когда-вам-не-нужен-jekyll-contras>Когда вам не нужен jekyll (contras)
<span>
<a href=#%d0%ba%d0%be%d0%b3%d0%b4%d0%b0-%d0%b2%d0%b0%d0%bc-%d0%bd%d0%b5-%d0%bd%d1%83%d0%b6%d0%b5%d0%bd-jekyll-contras><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><ul>
<li>Если у вас по-настоящему большой сайт и счет страниц идет на десятки тысяч. В принципе jekyll может работать с большими объемами данных, но это будет неудобно.</li>
<li>Если ваш сайт обновляется очень часто (новостное агентство, форум).</li>
<li>Если работа вашего сайта зависит от поведения пользователя на сайте (социальная сеть, персонализированные новости, интернет-магазин).</li>
<li>Если ваш сайт обновляется многими и из многих точек (twitter, сервис блогов).</li>
<li>Если нагрузка на ваш сайт по-настоящему велика и вы знаете, как заставить ваш код работать быстрее примитивной выгрузки данных с диска (да, это возможно). Но тогда я не понимаю, зачем вы вообще читаете эту простыню.</li>
</ul>
<h2 id=установка>Установка
<span>
<a href=#%d1%83%d1%81%d1%82%d0%b0%d0%bd%d0%be%d0%b2%d0%ba%d0%b0><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Для работы jekyll вам потребуется ruby, способов его установки настолько много, что я не буду на этом сейчас останавливаться. После установки ruby ставим гем jekyll:</p>
<pre><code>&gt; gem install jekyll
</code></pre>
<p>Теперь переходим в папку, где будет лежать сайт. На всякий случай напомню, что это не тот сайт, который будет доступен в сети, а тот, который служит источником данных. Создадим &ldquo;пустой&rdquo; сайт:</p>
<pre><code>&gt; jekyll new ./testsite

Running bundle install in ~/testsite...
  Bundler: Fetching gem metadata from https://rubygems.org/...........
  Bundler: Fetching version metadata from https://rubygems.org/..
  Bundler: Fetching dependency metadata from https://rubygems.org/.
  Bundler: Resolving dependencies...
  Bundler: Fetching public_suffix 3.0.0
  Bundler: Installing public_suffix 3.0.0
  Bundler: Using bundler 1.15.2
  Bundler: Using colorator 1.1.0
  Bundler: Using ffi 1.9.18
  Bundler: Using forwardable-extended 2.6.0
  Bundler: Using rb-fsevent 0.10.2
  Bundler: Fetching kramdown 1.15.0
  Bundler: Installing kramdown 1.15.0
  Bundler: Using liquid 4.0.0
  Bundler: Using mercenary 0.3.6
  Bundler: Using rouge 1.11.1
  Bundler: Using safe_yaml 1.0.4
  Bundler: Fetching addressable 2.5.2
  Bundler: Installing addressable 2.5.2
  Bundler: Using rb-inotify 0.9.10
  Bundler: Using pathutil 0.14.0
  Bundler: Fetching sass-listen 4.0.0
  Bundler: Installing sass-listen 4.0.0
  Bundler: Using listen 3.0.8
  Bundler: Fetching sass 3.5.1
  Bundler: Installing sass 3.5.1
  Bundler: Using jekyll-watch 1.5.0
  Bundler: Using jekyll-sass-converter 1.5.0
  Bundler: Using jekyll 3.5.0
  Bundler: Using jekyll-feed 0.9.2
  Bundler: Using minima 2.1.1
  Bundler: Bundle complete! 4 Gemfile dependencies, 22 gems now installed.
  Bundler: Use `bundle info [gemname]` to see where a bundled gem is installed.
  Bundler: The latest bundler is 1.16.0.pre.2, but you are currently running 1.15.2.
  Bundler: To update, run `gem install bundler --pre`
New jekyll site installed in ~/testsite.
</code></pre>
<p>Самый простой способ убедится, что сайт создался и работает - собрать его. Команда <code>jekyll serve</code> обработает имеющиеся данные и соберет статический сайт, а затем запустит маленький веб-сервер, чтобы можно было посмотреть на сайт. Эту команду надо выполнить внутри папки сайта:</p>
<pre><code>&gt; cd ./testsite
&gt; jekyll serve

Configuration file: /home/testsite/_config.yml
   Deprecation: The 'gems' configuration option has been renamed to 'plugins'. Please update your config file accordingly.
        Source: /home/testsite
   Destination: /home/testsite/_site
Incremental build: disabled. Enable with --incremental
  Generating...
                done in 0.812 seconds.
Auto-regeneration: enabled for '/home/testsite'
Server address: http://127.0.0.1:4000/
Server running... press ctrl-c to stop.
</code></pre>
<p>Теперь можно зайти браузером на <code>http://127.0.0.1:4000</code> и полюбоваться на сайт:</p>
<p>![jekyll new]({{ site.baseurl }}{% link /assets/img/jekyll-new.png %})</p>
<h2 id=быстрый-старт>Быстрый старт
<span>
<a href=#%d0%b1%d1%8b%d1%81%d1%82%d1%80%d1%8b%d0%b9-%d1%81%d1%82%d0%b0%d1%80%d1%82><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h2><p>Jekyll изначально - движок для блогов. Это не значит, что на нем можно писать только блоги, просто с блогами там работать легче всего. Все блог-посты, которые будут видны на сайте, jekyll ищет в каталоге <code>_posts</code>. Название у файла должно соответствовать шаблону <code>YYYY-MM-DD-slug.md</code>, где:</p>
<ul>
<li>YYYY год в четырехсимвольном формате (2010)</li>
<li>MM месяц в двухсимвольном формате (03 – март).</li>
<li>DD в двухсимвольном формате (08 - 8 Марта).</li>
<li>slug - произвольное название статьи на английском языке. Регистр букв (большая-маленькая) – учитываться не будет. Реально slug нужен на тот случай, если у вас два сообщения в один день.</li>
<li>md - подсказка, что это формат markdown. Jekyll поддерживает и другие форматы, но в данном примере я буду рассматривать markdown, он очень простой.</li>
</ul>
<p>Заголовок (шапка) файла тоже имеет определенные требования, вот пример:</p>
<pre><code>---
layout: post
title: &quot;Текст про 8 марта&quot;
date: &quot;2010-03-08 8:00:00+03:00&quot;
---
</code></pre>
<p>Что тут написано:</p>
<ul>
<li><code>layout: post</code> указывает jekyll, какой шаблон нужно использовать для отрисовки (перевода) данного статического текста в html-страницу. Post - стандартный шаблон, который идет в комплекте, и если нет уверенности – проще всего брать его.</li>
<li><code>title</code> - это заголовок страницы. Именно этот текст будет отображен в списке постов на главной странице и именно этот текст будет в шапке страницы, когда пользователь ее откроет.</li>
<li><code>date</code> - дата и время публикации. Время указывается в 24-формате с точностью до секунды, через <code>+</code> (или <code>-</code>) указывается тайм-зона. Ее указывать не обязательно, но тогда будет использоваться та, что указана в настройках. Эти дата и время будут показаны на сайте. Если их не указать – дата публикации будет взята из названия файла (если указать - из этого поля, а дата из названия будет игнорироваться).</li>
</ul>
<p>Пропускаем строку после заголовка и можно писать текст</p>
<h3 id=лирическое-отступление-markdown>Лирическое отступление: markdown
<span>
<a href=#%d0%bb%d0%b8%d1%80%d0%b8%d1%87%d0%b5%d1%81%d0%ba%d0%be%d0%b5-%d0%be%d1%82%d1%81%d1%82%d1%83%d0%bf%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-markdown><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><p>Markdown – это простой язык разметки. Он нужен для того, чтобы разделять в тексте заголовки и абзацы, делать текст <strong>жирным</strong> или <em>курсивным</em>. HTML, на котором написаны страницы, которые лежат в интернете – тоже язык разметки. Но HTML – язык сложный, мощный, гибкий и не прощающий ошибок. Markdown – напротив, специально сделан предельно простым, пусть и в ущерб гибкости.</p>
<p>Markdown прекрасно понимает переносы строк. Нужно отделить один абзац от другого – достаточно одной пустой строки между ними.</p>
<p>Для заголовков используется символ <code>#</code>. Ставится он только с одной стороны и заголвок считается только с новой строки. Пример:</p>
<ul>
<li><code># заголовок</code> заголовок первого уровня (H1). Самый крупный.</li>
<li><code>## заголовок поменьше</code> - заголовок второго уровня (h2). Поменьше.</li>
<li><code>### подзаголовок</code> - заголовок третьего уровня. Самый маленький.</li>
</ul>
<p>Для оформления текста внутри абзаца:</p>
<ul>
<li><code>**жирный**</code> - две звездочки сделают текст жирным (<strong>bold</strong>).</li>
<li><code>*курсивный*</code> - одна звездочка сделает текст наклонным (<em>italic</em>)</li>
<li><code>***жирный и курсивный***</code> - три звездочки сделают текст и жирным и курсивным <em><strong>сразу</strong></em></li>
</ul>
<p>Для ссылок:</p>
<ul>
<li><code>[ссылка обычная](https://yandex.ru)</code> - создаст обычную ссылку. Текст будет взят из <code>[]</code>, а вести она будет по адресу <code>()</code>.</li>
<li><code>![картинка](https://yandex.ru/image.jpg)</code> - на странице появится картинка. Обратите внимание на <code>!</code> в начале.</li>
</ul>
<p>Чтобы создать список - начинайте строку с символа <code>-</code> или <code>*</code> и пробела за ним. Если у вас группа строк идет без разрыва, одна за другой – это будет воспринято как список:</p>
<pre><code>- первый пункт
- второй
- третий

тут немного текста

- первый пункт второго списка
- второй пункт второго списка
</code></pre>
<p>Полное описание стандарта можно найти <a href=https://daringfireball.net/projects/markdown/syntax>вот тут</a> (на английском языке). Существует огромное количество текстовых редакторов с поддержкой markdown, которые прямо во время редактирования показывают, каким будет оформление текста. Лично я пишу этот текст в прекрасном редакторе Sublime3.</p>
<h3 id=настройки-сайта>Настройки сайта
<span>
<a href=#%d0%bd%d0%b0%d1%81%d1%82%d1%80%d0%be%d0%b9%d0%ba%d0%b8-%d1%81%d0%b0%d0%b9%d1%82%d0%b0><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><p>Глобальные настройки сайта находятся в файле <code>_config.yml</code>. Он довольно очевидный и легко читается. Что я рекомендую в нем поменять:</p>
<ul>
<li>title - заголовок сайта. Отображается на каждой странице</li>
<li>description - описание сайта. Отображается на каждой странице стандартного шаблона внизу экрана</li>
<li>email, twitter_username, github_username - необязательные поля. Если есть - отображаются внизу экрана.</li>
<li>url - адрес вашего сайта в сети. Важен для внутренних ссылок.</li>
<li>baseurl - нужен в том случае, если jekyll является не основным сайтом, а только его частью и расположен в отдельной локации (к пример - по адресу <code>/blog/</code>). Baseurl будет автоматически добавляется перед началом каждого адреса, который есть в jekyll. Это довольно редкая настройка.</li>
<li>timezone - временная зона по умолчанию, задается в стандартном виде <code>Регион/Город</code>. Типичная настройка для европейской части России - <code>Europe/Moscow</code>.</li>
</ul>
<p>Обычно настройки достаточно поменять один раз.</p>
<h3 id=дополнительные-страницы>Дополнительные страницы
<span>
<a href=#%d0%b4%d0%be%d0%bf%d0%be%d0%bb%d0%bd%d0%b8%d1%82%d0%b5%d0%bb%d1%8c%d0%bd%d1%8b%d0%b5-%d1%81%d1%82%d1%80%d0%b0%d0%bd%d0%b8%d1%86%d1%8b><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><p>Обычно в блоге кроме собственно постов есть статические страницы, например – описание сайта или страница контактов. Jekyll позволяет создать такие страницы. Эти страницы не отображаются в списке постов на главной, но зато они видны в шапке сайта (сверху). Такие страницы нужно создавать прямо в корне (папке, где находятся все файлы jekyll) и в их названии не обязательно должна быть дата, достаточно просто имени и расширения md. Имя должно содержать только английские буквы, точку и тире (в противном случае могут быть сюрпризы). У страницы в заголовке должен быть обязательный атрибут <code>permalink</code> – это указание jekyll, по какому адресу эта страница должна быть видна на сайте. В остальном такие файлы ничем не отличаются от файлов блог-постов, которые я описывал выше.</p>
<h3 id=генерация-и-выкладка>Генерация и выкладка
<span>
<a href=#%d0%b3%d0%b5%d0%bd%d0%b5%d1%80%d0%b0%d1%86%d0%b8%d1%8f-%d0%b8-%d0%b2%d1%8b%d0%ba%d0%bb%d0%b0%d0%b4%d0%ba%d0%b0><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><p>Итак, текст написан, можем выкладывать. Чтобы собрать сайт из страниц-заготовок - используйте команду <code>jekyll build</code>. Ответ будет выглядеть примерно так:</p>
<pre><code>&gt; jekyll build
Configuration file: /home/testsite/_config.yml
            Source: /home/testsite
       Destination: /home/testsite/_site
 Incremental build: disabled. Enable with --incremental
      Generating...
                    done in 1.683 seconds.
 Auto-regeneration: disabled. Use --watch to enable.
</code></pre>
<p>В нормальном состоянии jekyll не должен как-то ругаться, выбрасывать предупреждения или ошибки. Если они все же есть – рекомендую их внимательно прочитать. Обычно прямо в тексте ошибки есть указание на то, как ее исправить.</p>
<p>Готовые к выкладке файлы будут ждать в папке <code>_site</code>. Теперь достаточно просто скопировать их на хостинг (подойдет совершенно любой хостинг, который позволяет загружать на него файлы) - и сайт доступен в интернете. На хостинг нужно отправлять только содержимое папки <code>_site</code>, ничего больше отправлять не нужно! Для размещения сайта можно, например, использовать совершенно бесплатный <a href=https://pages.github.com/>github pages</a>, но в принципе – найти хостинг бесплатный или очень дешевый хостинг - несложно. Благо, все, что от него требуется – возможность хоть в каком-то виде отправлять на него файлы.</p>
<h3 id=добавление-удаление-контента>Добавление-удаление контента
<span>
<a href=#%d0%b4%d0%be%d0%b1%d0%b0%d0%b2%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d1%83%d0%b4%d0%b0%d0%bb%d0%b5%d0%bd%d0%b8%d0%b5-%d0%ba%d0%be%d0%bd%d1%82%d0%b5%d0%bd%d1%82%d0%b0><svg viewBox="0 0 28 23" height="100%" width="19" xmlns="http://www.w3.org/2000/svg"><path d="M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/><path d="M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71" fill="none" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2"/></svg>
</a>
</span>
</h3><p>В обновлении сайта нет ничего сложного, но на всякий случай я опишу его тезисно:</p>
<ul>
<li>пишем новый текст. Файл кладем в <code>_posts</code>, если это запись в блоге или в корень сайта на жестком диске, если это – простая страница</li>
<li>выполняем <code>jekyll build</code>, чтобы пересобрать сайт</li>
<li>загружаем содержимое папки <code>_site</code> на хостинг. Если какие-то файлы на хостинге уже есть с прошлого раза – перезаписываем.</li>
<li>сайт обновлен и готов к использованию</li>
</ul>
</div>
<div class=post-info>
<div class="post-date dt-published">2017-09-15</div>
<a class="post-hidden-url u-url" href=https://prudnitskiy.pro/post/2017-09-15-jekyll/>https://prudnitskiy.pro/post/2017-09-15-jekyll/</a>
<a href=https://prudnitskiy.pro class="p-name p-author post-hidden-author h-card" rel=me>Paul Rudnitskiy</a>
<div class=post-taxonomies>
<ul class=post-tags>
<li><a href=https://prudnitskiy.pro/tags/blog/>#blog</a></li>
<li><a href=https://prudnitskiy.pro/tags/usability/>#usability</a></li>
<li><a href=https://prudnitskiy.pro/tags/ruby/>#ruby</a></li>
</ul>
</div>
</div>
</article>
<div class="pagination post-pagination">
<div class="left pagination-item">
<a href=/post/2017-09-30-duplicity/>Duplicity – экстремально простой способ резервного копирования</a>
</div>
<div class="right pagination-item">
<a href=/post/2016-04-21-xtrabackup/>Резервное копироварие mysql с помощью xtrabackup</a>
</div>
</div>
</main>
<footer class=common-footer>
<div class=common-footer-bottom>
<div class=copyright>
<p>© Paul Rudnitskiy, 2023<br>
Powered by <a target=_blank rel="noopener noreferrer" href=https://gohugo.io/>Hugo</a>, theme <a target=_blank rel="noopener noreferrer" href=https://github.com/mitrichius/hugo-theme-anubis>Anubis</a>.<br>
</p>
</div>
<button class=theme-switcher>
Dark theme
</button>
<script>const STORAGE_KEY='user-color-scheme',defaultTheme="auto";let currentTheme,switchButton,autoDefinedScheme=window.matchMedia('(prefers-color-scheme: dark)');const autoChangeScheme=a=>{currentTheme=a.matches?'dark':'light',document.documentElement.setAttribute('data-theme',currentTheme),changeButtonText()};document.addEventListener('DOMContentLoaded',function(){switchButton=document.querySelector('.theme-switcher'),currentTheme=detectCurrentScheme(),currentTheme=='dark'&&document.documentElement.setAttribute('data-theme','dark'),currentTheme=='auto'&&(autoChangeScheme(autoDefinedScheme),autoDefinedScheme.addListener(autoChangeScheme)),changeButtonText(),switchButton.addEventListener('click',switchTheme,!1)});function detectCurrentScheme(){return localStorage.getItem(STORAGE_KEY)?localStorage.getItem(STORAGE_KEY):defaultTheme?defaultTheme:window.matchMedia?window.matchMedia('(prefers-color-scheme: dark)').matches?'dark':'light':'light'}function changeButtonText(){switchButton.textContent=currentTheme=='dark'?"Light theme":"Dark theme"}function switchTheme(a){currentTheme=='dark'?(localStorage.setItem(STORAGE_KEY,'light'),document.documentElement.setAttribute('data-theme','light'),currentTheme='light'):(localStorage.setItem(STORAGE_KEY,'dark'),document.documentElement.setAttribute('data-theme','dark'),currentTheme='dark'),changeButtonText()}</script>
</div>
<p class="h-card vcard">
<a href=https://prudnitskiy.pro class="p-name u-url url fn" rel=me>Paul Rudnitskiy</a>
<img class=u-photo src=/assets/avatars/ba.jpg>
</p>
</footer>
</div>
</body>
</html>